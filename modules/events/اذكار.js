module.exports.config = {
  name: "autoAdhkar",
  version: "1.1.0",
  credits: "Ayman",
  description: "إرسال أذكار تلقائية (صدقة جارية) كل 30 دقيقة لجميع المجموعات"
};

module.exports.onLoad = async function({ api }) {
  const adhkarList = [
    "سبحان الله وبحمده", "سبحان الله العظيم", "أستغفر الله وأتوب إليه", 
    "لا إله إلا الله وحده لا شريك له", "الحمد لله رب العالمين", "الله أكبر كبيراً",
    "لا حول ولا قوة إلا بالله", "اللهم صلِ وسلم على نبينا محمد", "سبحان الله",
    "الحمد لله", "لا إله إلا الله", "الله أكبر", "حسبي الله ونعم الوكيل",
    "رضيت بالله رباً وبالإسلام ديناً", "يا حي يا قيوم برحمتك أستغيث",
    "اللهم اغفر لي ولوالدي", "اللهم إنك عفو كريم تحب العفو فاعفُ عني",
    "سبحان الله وبحمده عدد خلقه", "لا إله إلا أنت سبحانك إني كنت من الظالمين",
    "أستغفر الله العظيم الذي لا إله إلا هو الحي القيوم",
    "اللهم بك أصبحنا وبك أمسينا", "اللهم إني أسألك علماً نافعاً",
    "يا مقلب القلوب ثبت قلبي على دينك", "اللهم آتنا في الدنيا حسنة",
    "الحمد لله حمداً كثيراً طيباً مباركاً فيه", "أمسنا وأمسى الملك لله",
    "اللهم إني أعوذ بك من العجز والكسل", "سبحان الملك القدوس",
    "اللهم عافني في بدني", "اللهم اكفني بحلالك عن حرامك",
    "أستغفر الله العظيم لي وللمسلمين", "لا إله إلا الله الملك الحق المبين",
    "اللهم إني أسألك الجنة", "اللهم أجرني من النار",
    "اللهم إني أعوذ بك من الهم والحزن", "سبحان الله والحمد لله",
    "اللهم ارحم موتانا وموتى المسلمين", "اللهم اشفِ مرضانا ومرضى المسلمين",
    "اللهم صلِ على محمد وعلى آل محمد", "سبحان الله وبحمده زنة عرشه",
    "أستغفر الله العظيم", "اللهم اجعلني مقيم الصلاة ومن ذريتي",
    "اللهم ارزقني حسن الخاتمة", "لا إله إلا الله محمد رسول الله",
    "اللهم إني أسألك الهدى والتقى", "يا رب ارحمني برحمتك",
    "الحمد لله على كل حال", "سبحان الله بكرة وأصيلاً",
    "اللهم اجعل القرآن ربيع قلبي", "أستغفر الله"
  ];

  // دالة الإرسال
  const sendAdhkar = () => {
    api.getThreadList(100, null, ["INBOX"], (err, list) => {
      if (err) return console.log("خطأ في جلب المجموعات: " + err);
      
      list.forEach(thread => {
        // الإرسال للمجموعات فقط وتجنب الحسابات الشخصية (اختياري)
        if (thread.isGroup && thread.threadID) {
          const randomAdhkar = adhkarList[Math.floor(Math.random() * adhkarList.length)];
          const message = `◈ ───『 صـدقـة جـاريـة 』─── ◈\n\n◯ ${randomAdhkar}\n\n◈ ─────────────── ◈\n│←› تـم الـتـطـويـر بـواسطـة ايـمـن\n│←› اسـتـمـتـع بـاسـتـخـدام هـبـة\n◈ ─────────────── ◈`;
          
          api.sendMessage(message, thread.threadID, (error) => {
            if (error) console.log(`فشل الإرسال للمجموعة ${thread.threadID}`);
          });
        }
      });
    });
  };

  // تشغيل المؤقت (كل 30 دقيقة = 1800000 ملي ثانية)
  setInterval(sendAdhkar, 1800000);
  
  // ملاحظة: سيبدأ الإرسال الأول بعد 30 دقيقة من تشغيل البوت. 
  // إذا أردت إرسال دفعة فور تشغيل البوت، يمكنك استدعاء الدالة هنا:
  // sendAdhkar(); 
};

module.exports.handleEvent = function() {
  // نتركها فارغة لأننا نعتمد على onLoad الآن
};
